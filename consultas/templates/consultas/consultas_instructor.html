{% extends layout %}

{% block content %}

{% comment %} Mostar esto solo al funcionario {% endcomment %}
{%  if rol == 3 %}
<!-- Sección principal - Consultar Fichas -->
<main class="contenido-principal">
  <!-- Título de la sección -->
  <div class="titulo-seccion">
    <h2 class="titulo-pagina">Consultar solicitudes {{ user }} {{ user_name }}</h2>
    <p class="subtitulo-pagina">
      Aquí puede consultar el estado de las fichas solicitadas y descargar los documentos correspondientes
    </p>
  </div>

  <!-- Contenedor de la tabla de fichas -->
  <div class="contenedor-tabla-fichas">
    <table class="tabla-fichas">
      <thead>
        <tr>
          <th>Nombre del Programa</th>
          <th>Estado</th>
          <th>Descargar ficha de caracterización</th>
          <th>Descargar documento de los aspirantes</th>
          <th>Descargar formato inscripcion masivo</th>
          <th>Fecha de Creación</th>
          {% comment %} <th>Compartir</th> {% endcomment %}
        </tr>
      </thead>
      <tbody>
        {% for solicitud_consulta in solicitudes %}
        <tr>
          <td>{{ solicitud_consulta.codigoprograma.nombreprograma }}</td>
            <td>        
              <select>
                <option value="">-- Seleccione un estado --</option>
                {% for item in estado %}
                <option value="{{ item.idestado }}">{{ item.estados }}</option>
                {% endfor %}
              </select>
            </td>
          <td><a href="{% url 'ficha_caracterizacion_pdf' solicitud_consulta.idsolicitud %}" style="background:#007bff;color:#fff;padding:8px 14px;text-decoration:none;border-radius:4px;font-size:12px;">Descargar PDF</a></td>
          <td><a href="{% url 'descargar_pdf' solicitud_consulta.idsolicitud rol %}" class="boton-descargar">Descargar PDF</a></td>
          <td>
            <!-- Este es el enlace de descarga (visible al inicio) -->
            <a href="{% url 'descargar_excel' solicitud_consulta.idsolicitud rol %}" 
              class="boton-descargar"
              id="descargar-excel">Descargar excel</a>

            <!-- Este es el campo de subida (oculto al inicio) -->
            {% comment %} <div id="subida-reemplazo" style="display: none;">
              <input type="file" id="archivo-subida">
              <button>Subir archivo</button>
            </div> {% endcomment %}
          </td>
          <td>{{ solicitud_consulta.fechasolicitud }}</td>
          {% comment %} <td>
            <!-- Botón para abrir su propio modal -->
            <button
              onclick="document.getElementById('modal-{{ solicitud_consulta.idsolicitud }}').style.display='block'"
              class="boton-compartir">
              Compartir
            </button> 
          </td> {% endcomment %}
        </tr>

        <!-- Modal único para esta solicitud -->
        <div id="modal-{{ solicitud_consulta.idsolicitud }}" class="modal-compartir" style="display: none;">
          <div class="contenido-modal">
            <div class="encabezado-modal">
              <h3>Compartir Ficha</h3>
              <!-- Botón para cerrar este modal -->
              <button
                onclick="document.getElementById('modal-{{ solicitud_consulta.idsolicitud }}').style.display='none'"
                class="boton-cerrar-modal">&times;</button>
            </div>

            <div class="cuerpo-modal">
              <p class="programa-seleccionado">
                Programa: {{ solicitud_consulta.codigoprograma.nombreprograma }}
              </p>
              {% comment %} <p class="programa-seleccionado">
                ID de Solicitud: {{ solicitud_consulta.idsolicitud }}
              </p> {% endcomment %}

              <!-- ✅ Enlace con href correcto y texto original -->
              <div class="opcion-compartir">
                <h4>Compartir con enlace</h4>
                <div class="grupo-link">
                  <!-- HREF con el ID correcto, texto NO modificado -->
                  <a href="{% url 'formularioaspirantes' solicitud_consulta.idsolicitud %}">
                    https://preinscripcion/{{codigo}}
                  </a>
                </div>
              </div>

              <div class="separador-modal">
                <span>O</span>
              </div>

              <!-- Opción 2: Compartir con aprendiz específico -->
              <div class="opcion-compartir">
                <h4>Compartir con aprendiz específico</h4>
                <p class="descripcion-opcion">
                  Busca y selecciona un aprendiz para compartir directamente
                </p>

                <div class="grupo-busqueda">
                  <label for="buscar-aprendiz-{{ solicitud_consulta.idsolicitud }}">Buscar aprendiz:</label>
                  <input type="text" id="buscar-aprendiz-{{ solicitud_consulta.idsolicitud }}"
                    class="input-busqueda" placeholder="Escribe el nombre o documento del aprendiz..." />

                  <!-- Lista de resultados (estática/simulada) -->
                  <div class="resultados-busqueda">
                    <div class="item-aprendiz">
                      <div class="info-aprendiz">
                        <span class="nombre-aprendiz">Juan Carlos Pérez</span>
                        <span class="documento-aprendiz">C.C. 1.234.567.890</span>
                      </div>
                      <button>Seleccionar</button>
                    </div>
                    <div class="item-aprendiz">
                      <div class="info-aprendiz">
                        <span class="nombre-aprendiz">María Fernanda López</span>
                        <span class="documento-aprendiz">C.C. 9.876.543.210</span>
                      </div>
                      <button>Seleccionar</button>
                    </div>
                    <div class="item-aprendiz">
                      <div class="info-aprendiz">
                        <span class="nombre-aprendiz">Carlos Eduardo Martínez</span>
                        <span class="documento-aprendiz">C.C. 5.555.555.555</span>
                      </div>
                      <button>Seleccionar</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Pie del modal -->
            <div class="pie-modal">
              <button
                onclick="document.getElementById('modal-{{ solicitud_consulta.idsolicitud }}').style.display='none'"
                class="boton-cancelar">Cancelar</button>
              <button class="boton-compartir-modal">Compartir</button>
            </div>
          </div>
        </div>
        {% endfor %}
      </tbody>
    </table>
  </div>
</main>

{% comment %} Mostrar esto si quien ingresa al sistema es un Coordinador {% endcomment %}
{% elif rol == 2 %}

<main class="contenido-principal">
  <!-- Título de la sección -->
  <div class="titulo-seccion">
    <h2 class="titulo-pagina">Consultar solicitudes {{ user }} {{ user_name }}</h2>
    <p class="subtitulo-pagina">
      Aquí puede consultar el estado de las fichas solicitadas y descargar los documentos correspondientes
    </p>
  </div>

  <!-- Contenedor de la tabla de fichas -->
  <div class="contenedor-tabla-fichas">
    <table class="tabla-fichas">
      <thead>
        <tr>
          <th>Nombre del Programa</th>
          <th>Estado</th>
          <th>Ficha de Caracterización</th>
          <th>Fecha de Creación</th>
          <th>obsevacion de solicitud</th>
          <th>Compartir</th>
        </tr>
      </thead>
      <tbody>
        {% for solicitud_consulta in solicitudes %}
            <tr>
              <td>{{ solicitud_consulta.codigoprograma.nombreprograma }}</td>
              <td>        
                <select>
                  <option value="">-- Seleccione un estado --</option>
                  {% for item in estado %}
                    <option value="{{ item.idestado }}">{{ item.estados }}</option>
                  {% endfor %}
                </select>
              </td>
              <td><a href="{% url 'ficha_caracterizacion' solicitud_consulta.idsolicitud %}" class="boton-descargar">Ver ficha Caracterización</a></td>
              {% comment %} <td><a href="{% url 'descargar_pdf' solicitud_consulta.idsolicitud %}" class="boton-descargar">Descargar PDF</a></td> {% endcomment %}
              <td>{{ solicitud_consulta.fechasolicitud }}</td>
              <td>
              <textarea name="observacion" id="observacion" cols="30" rows="2" placeholder="Escribe tu observación aquí..."></textarea>
              </td>
              <td>
                  <button
                      class="boton-compartir"
                      data-id="{{ solicitud_consulta.idsolicitud }}"
                      onclick="compartirSolicitud(this)">
                      Compartir
                  </button>
              </td>
           </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</main>

{% else %}

{% comment %} Mostrar esto si quien ingresa al sistema es un Instructor-Administrador {% endcomment %}

<!-- Sección principal - Consultar Fichas -->
<main class="contenido-principal">
  <!-- Título de la sección -->
  <div class="titulo-seccion">
    <h2 class="titulo-pagina">Consultar solicitudes {{ user }} {{ user_name }}</h2>
    <p class="subtitulo-pagina">
      Aquí puede consultar el estado de las fichas solicitadas y descargar los documentos correspondientes
    </p>
  </div>

  <!-- Contenedor de la tabla de fichas -->
  <div class="contenedor-tabla-fichas">
    <table class="tabla-fichas">
      <thead>
        <tr>
          <th>Nombre del Programa</th>
          <th>Estado</th>
          <th>Ficha de Caracterización</th>
          <th>Documentos de Aprendices</th>
          <th>Fecha de Creación</th>
          <th>Compartir</th>
        </tr>
      </thead>
      <tbody>
        {% for solicitud_consulta in solicitudes %}
        <tr>
          <td>{{ solicitud_consulta.codigoprograma.nombreprograma }}</td>
          <td><span class="estado-aprobado">Esto depende de la tabla ficha</span></td>
          <td><a href="{% url 'ficha_caracterizacion' solicitud_consulta.idsolicitud %}" class="boton-descargar">Ver ficha Caracterización</a></td>
          <td>
            {% if solicitud_consulta.aspirantes %}
              {{ solicitud_consulta.aspirantes|length }} aspirante{{ solicitud_consulta.aspirantes|length|pluralize }}
            {% else %}
              Sin aspirantes
            {% endif %}
          </td>
          <td>{{ solicitud_consulta.fechasolicitud }}</td>
          <td>
            <!-- Botón para abrir su propio modal -->
            <button
              onclick="document.getElementById('modal-{{ solicitud_consulta.idsolicitud }}').style.display='block'"
              class="boton-compartir">
              Compartir
            </button>
          </td>
        </tr>

        <!-- Modal único para esta solicitud -->
        <div id="modal-{{ solicitud_consulta.idsolicitud }}" class="modal-compartir" style="display: none;">
          <div class="contenido-modal">
            <div class="encabezado-modal">
              <h3>Compartir Ficha</h3>
              <!-- Botón para cerrar este modal -->
              <button
                onclick="document.getElementById('modal-{{ solicitud_consulta.idsolicitud }}').style.display='none'"
                class="boton-cerrar-modal">&times;</button>
            </div>

            <div class="cuerpo-modal">
              <p class="programa-seleccionado">
                Programa: {{ solicitud_consulta.codigoprograma.nombreprograma }}
              </p>
              {% comment %} <p class="programa-seleccionado">
                ID de Solicitud: {{ solicitud_consulta.idsolicitud }}
              </p> {% endcomment %}

              <!-- ✅ Enlace con href correcto y texto original -->
              <div class="opcion-compartir">
                <h4>Compartir con enlace</h4>
                <div class="grupo-link">
                  <!-- HREF con el ID correcto, texto NO modificado -->
                  <a href="{% url 'formularioaspirantes' solicitud_consulta.idsolicitud %}">
                    https://preinscripcion/{{codigo}}
                  </a>
                </div>
              </div>

              <div class="separador-modal">
                <span>O</span>
              </div>

              <!-- Opción 2: Ver aspirantes inscritos -->
              <div class="opcion-compartir">
                <h4>Ver aspirantes Inscritos</h4>
                <div class="grupo-busqueda">

                  <!-- Lista de aspirantes -->
                  <div class="resultados-busqueda">
                    {% for aspirante in solicitud_consulta.aspirantes %}
                    <div class="item-aprendiz">
                      <div class="info-aprendiz">
                        <span class="nombre-aprendiz">{{ aspirante.nombre }} {{ aspirante.apellido }}</span>
                        <span class="documento-aprendiz">{{ aspirante.tipoidentificacion.tipoidentificacion }} {{ aspirante.numeroidentificacion }}</span>
                        <span class="documento-aprendiz">Teléfono: {{ aspirante.telefono }}</span>
                        <span class="documento-aprendiz">Correo: {{ aspirante.correo }}</span>
                      </div>
                    </div>
                    {% empty %}
                    <div class="item-aprendiz">
                      <div class="info-aprendiz">
                        <span class="nombre-aprendiz">No hay aspirantes registrados para esta ficha</span>
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>

            <!-- Pie del modal -->
            <div class="pie-modal">
              <button
                onclick="document.getElementById('modal-{{ solicitud_consulta.idsolicitud }}').style.display='none'"
                class="boton-cancelar">Cancelar</button>
              <button class="boton-compartir-modal">Compartir</button>
            </div>
          </div>
        </div>
        {% endfor %}
      </tbody>
    </table>
  </div>
</main>
{% endif %}

{% endblock %}